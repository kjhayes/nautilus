#!/usr/bin/env bash

# Exit on any errors
set -e

# make the root filesystem (lfs)
make ramdisk.img

# hack: delete `src/asm/ramdisk.o` so the root filesystem gets updated (we use a RAM filesystem to avoid complications)
rm -f src/asm/ramdisk.o

# build the kernel and the isoimage for it
make isoimage -j $(nproc)


# qemu-system-x86_64 -smp 2 -m 2048 -vga std -serial stdio -cdrom nautilus.iso $@
qemu-system-x86_64 -cdrom nautilus.iso -m 2G -serial mon:stdio $@
